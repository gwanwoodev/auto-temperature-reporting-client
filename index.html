<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ATR-Service</title>
    <link rel="stylesheet" href="./src/css/reset.css">
    <link rel="stylesheet" href="./src/css/global.css">
    <link rel="stylesheet" href="./src/css/mdc-min.css">
</head>

<body>
    <header class="mdc-top-app-bar">
        <div class="mdc-top-app-bar__row">
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
                <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button"
                    aria-label="Open navigation menu">menu</button>
                <span class="mdc-top-app-bar__title">Auto-Temperature-Reporting-Client</span>
            </section>
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
                <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Favorite"
                    id="coffee">favorite</button>
            </section>
        </div>
    </header>

    <div class="mdc-dialog">
        <div class="mdc-dialog__container">
            <div class="mdc-dialog__surface" role="alertdialog" aria-modal="true" aria-labelledby="my-dialog-title"
                aria-describedby="my-dialog-content">
                <div class="mdc-dialog__content" id="my-dialog-content">
                    Give me a Coffee
                </div>
                <div class="mdc-dialog__actions">
                    <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="cancel">
                        <div class="mdc-button__ripple"></div>
                        <span class="mdc-button__label">OK</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="mdc-dialog__scrim"></div>
    </div>

    <form id="reportForm" method="POST" action="https://evening-cove-41985.herokuapp.com/api/report">
        <article>
            <label class="mdc-text-field mdc-text-field--filled">
                <span class="mdc-text-field__ripple"></span>
                <input class="mdc-text-field__input" type="text" aria-labelledby="my-label-id" id="email">
                <span class="mdc-floating-label" id="my-label-id">E-MAIL</span>
                <span class="mdc-line-ripple"></span>
            </label>
        </article>

        <article>
            <label class="mdc-text-field mdc-text-field--filled">
                <span class="mdc-text-field__ripple"></span>
                <input class="mdc-text-field__input" type="password" aria-labelledby="my-label-id" id="password">
                <span class="mdc-floating-label" id="my-label-id">Password</span>
                <span class="mdc-line-ripple"></span>
            </label>
        </article>

        <article>
            <label class="mdc-text-field mdc-text-field--filled">
                <span class="mdc-text-field__ripple"></span>
                <input class="mdc-text-field__input" type="text" aria-labelledby="my-label-id" id="hugaDate">
                <span class="mdc-floating-label" id="my-label-id">휴가복귀일(예시 2020-07-13)</span>
                <span class="mdc-line-ripple"></span>
            </label>
        </article>

        <article>
            <button class="mdc-button mdc-button--raised" id="submit">
                <div class="mdc-button__ripple"></div>
                <span class="mdc-button__label">SEND</span>
            </button>
        </article>
    </form>

    <!-- Required Material Web JavaScript library -->
    <script src="./src/js/mdc-min.js"></script>
    <!-- Instantiate single textfield component rendered in the document -->
    <script>
        mdc.topAppBar.MDCTopAppBar.attachTo(document.querySelector(".mdc-top-app-bar"));
        const topAppBarElement = document.querySelector('.mdc-top-app-bar');
        const dialog = mdc.dialog.MDCDialog.attachTo(document.querySelector(".mdc-dialog"));

        document.querySelector("#coffee").addEventListener("click", () => {
            dialog.open();
        });
        document.querySelectorAll(".mdc-text-field").forEach(tf => {
            mdc.textField.MDCTextField.attachTo(tf);
        });

        document.querySelector("#reportForm").addEventListener("submit", (evt) => {
            evt.preventDefault();
        });

        function sha512(str) {
            return crypto.subtle.digest("SHA-512", new TextEncoder("utf-8").encode(str)).then(buf => {
                return Array.prototype.map.call(new Uint8Array(buf), x => (('00' + x.toString(16)).slice(-2))).join('');
            });
        }

        document.querySelector("#submit").addEventListener("click", async (evt) => {
            evt.preventDefault();
            const email = document.querySelector("#email").value;
            const password = document.querySelector("#password").value;
            const hugaDate = document.querySelector("#hugaDate").value;
            const encryptPassword = await sha512(password);

            const httpRequest = new XMLHttpRequest();
            httpRequest.open("POST", "http://ec2-18-221-223-16.us-east-2.compute.amazonaws.com/api/report");
            httpRequest.setRequestHeader("Content-Type", "application/json");
            httpRequest.send(JSON.stringify({ "idVal": email, "pwVal": encryptPassword, "hugaDate": hugaDate }));

            httpRequest.onreadystatechange = (evt) => {
                if (httpRequest.readyState === XMLHttpRequest.DONE) {
                    if (httpRequest.status === 200) {
                        alert('OK');
                    }else {
						alert('X');
					}
                }
            }
        });
    </script>
</body>

</html>